# Coursework3 更新日志
北京大学软件与微电子学院 2019级嵌入式软件开发技术与工具 

组员：李普，李娟，卢意

## 2020年4月2日0:30更新

### 读者写者问题版本1(ReaderFirst.c)

1、循环创建6个读者线程和3个写者线程。

2、使用写互斥锁保证同时只有一个写者可以写数据。

3、创建读者计数器作为共享资源，使用信号控制读写，初始化为0，表示有0个读者。

4、读者进入时计数器加1，如果读者计数器加1后为1，表示该读者是第一个进入的读者，
此时要对资源加写互斥锁，保证资源不被写入。

5、读者读完后计数器减1，如果读者计数器减1后为0，表示该读者为最后一个读者，此
时要对资源去除互斥锁，保证资源可以被写入。

6、对读者线程，写者线程设置循环保持程序多次运行。

7、在主函数最后加入sleep(20)，保证所以的线程能够运行多遍。

### 待解决问题

1、创建线程时，先创建写者线程，再创建读者线程，会导致写者线程先运行完成，之后一直运行读者线程，
体现不了读者全部读完，后写者线程重新开始写入数据的过程。

2、是否可以使用互斥锁代替信号量控制读者计数器的加减。

3、尚未实现写者优先算法。

## 2020年4月5日更新

### 读者写者问题版本2(WriterReader.cpp)

1、在版本1的基础上实现了写者优先。增加一个写者计数器变量，读者在读之前，先判断写者计数器是否为0。

2、实现了用户自己随意输入写者和读者的数量，不需要预先定义。

3、实现了读者优先和写者优先的集成，让用户自己选择运行哪种优先模式。

4、写者和读者会循环运行，没有出现版本1中的问题1。

### 待解决问题

1、关于是否可以用互斥锁代替信号量的问题，个人认为在读者优先程序中可以，在写者优先程序中，写者程序既要控制计数器，又要加锁操作，如果用互斥锁控制计数器，会出现锁套锁的现象。


## 2020年4月5日 第二次更新

### 读者写者问题版本3(WriterReader)
1、更新每次进入读者线程和写者线程显示当前读者数和写者数的功能。

2、第一次更新时发现会有计数跳变的问题，分析后发现原因是没有将读者写者计数器的输出语句放到
信号量post之后，这导致在计数器加1和出输代码之间回有其他的读者线程完成计数器加一，由此产生
了计数器跳变，将输出语句和计数器加一语句都放入临界区之后问题解决

### 待解决问题
1、写者优先程序好像有些问题，无法在存在读者的情况下锁住读者。

## 2020年4月5日 第三次更新

### 读者写者问题版本3(WriterReader)
1、修复读者优先中的计数器判断错误

2、修改写者优先，解决写者之间无法互斥的问题和写者进行的时候无法锁住读者的问题。

### 待解决问题
暂无
