# 嵌入式软件开发与工具实验报告

## 多线程编程

第一组 组员：李普，李娟，卢意

### 一、实验目的

1、掌握基于pthread线程库的多线程编程技术；

2、掌握基本的线程间同步技术（sem,mutex）；

3、理解共享资源并掌握其操作方法。

### 二、实验内容

读者-写者问题多线程实现：
- 一个数据集（如数据、文件等）被N个线程读写；

- 一些线程只要求读数据集内容，称为读者，实验读者数不少于6个；

- 另些线程要求修改数据集内容，称为写者，实验写者数不少于3个；

- 多个读者同时读数据内容，不需要互斥操作；

- 一个写者不能和其他写者或读者同时访问数据集，换句话说，写者和其他写者或读者之间必须互斥操作！

- 读者优先：如果有读者，写者需要等待！用于更新不频繁或更新影响不显著、读者较多的场合；

- 写者优先：如果有写者，读者需要等待！用于更新频繁或更新影响显著的场合。

### 三、实验过程与结果

#### 1、实验思路

（1）首先根据题目意思可知，一个写者在向数据集写入数据的时候，与其他线程必须是互斥的，用互斥锁就可以实现；而读者线程在运行的时候，与写者线程互斥，但是与其他读者线程是可以同步的，所以不能用一个简单的互斥锁来解决，可以通过引入计数器的方法来实现。具体实现分为读者优先和写者优先两种情况。

（2）读者优先模式。读者线程运行时，用信号量sem控制同一时间只有一个读者线程控制读者计数器readercount，如果readercount大于0，即有读者读数据，则用互斥锁执行互斥操作，不让写者写数据，直到readercount=0，即所有读者线程都读完后，解开互斥锁，允许写操作执行。写操作执行时直接用互斥锁实现与其他线程互斥。

读者优先模式伪代码：
链接

（3）写者优先模式。同读者优先模式，引入一个写者计数器writercount，用信号量sem控制同一时间只有一个写者线程控制写者计数器，如果writercount大于0，即还有写操作在执行，则不执行读操作，直到writercount=0。

写者优先模式伪代码：
链接

#### 2、实验流程

实验流程图如下：
链接

#### 3、实验结果


### 四、实验总结

### 五、实验源码